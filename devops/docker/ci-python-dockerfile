ARG HASH
ARG USER
FROM "python:2-slim@$HASH"

LABEL maintainer="Freedom of the Press Foundation"
LABEL type="ci-pipenv-2"

RUN apt-get update &&\
    apt-get install --no-install-recommends git paxctl -y &&\
    apt-get clean && rm -rf /var/lib/apt/lists/* &&\
    rm -rf /usr/share/doc/ && rm -rf /usr/share/man &&\
    rm -rf /usr/share/locale

RUN adduser --gecos "" --uid $USER --disabled-password pyuser

USER pyuser
ENV PATH="~/.local/bin:$PATH"

RUN pipenv --python 2
RUN find ~/ -type f \( -name 'python*' \) -exec /sbin/paxctl -cm '{}' \;
